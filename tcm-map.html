<!DOCTYPE html>
<html>
  <head>
    <title>Nearby TCM Clinics</title>
    <style>
      html, body { height: 100%; margin: 0; padding: 0; }
      #map { height: 100%; }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script>
      function initMap(userLocation) {
        const map = new google.maps.Map(document.getElementById("map"), {
          center: userLocation,
          zoom: 14,
        });

        // Show user location
        new google.maps.marker.AdvancedMarkerElement({
          map: map,
          position: userLocation,
          title: "You are here",
        });

        // Search for TCM clinics using TextSearch
        const service = new google.maps.places.PlacesService(map);
        service.textSearch(
          {
            query: "Traditional Chinese Medicine clinic",
            location: userLocation,
            radius: 2000,
          },
          (results, status) => {
            if (status === google.maps.places.PlacesServiceStatus.OK && results) {
              results.forEach((place) => {
                if (place.geometry && place.geometry.location) {
                  const marker = new google.maps.marker.AdvancedMarkerElement({
                    map: map,
                    position: place.geometry.location,
                    title: place.name,
                  });

                  const infoWindow = new google.maps.InfoWindow({
                    content: `<strong>${place.name}</strong><br>${place.formatted_address}`,
                  });

                  marker.addListener("click", () => {
                    infoWindow.open(map, marker);
                  });
                }
              });
            } else {
              console.error("Places API error:", status);
            }
          }
        );
      }

      function getUserLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              initMap({
                lat: position.coords.latitude,
                lng: position.coords.longitude,
              });
            },
            () => {
              initMap({ lat: 1.3521, lng: 103.8198 }); // fallback: Singapore
            }
          );
        } else {
          initMap({ lat: 1.3521, lng: 103.8198 }); // fallback
        }
      }

      window.getUserLocation = getUserLocation;
    </script>

    <!-- Load Google Maps JavaScript API with 'places' and 'marker' libraries -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCSqqZiFermrGv95UXyp9RDmxxZQXtDcrI&libraries=places,marker&callback=getUserLocation"
      async
      defer
    ></script>
  </body>
</html>
