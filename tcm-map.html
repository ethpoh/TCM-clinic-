<!DOCTYPE html>
<html>
  <head>
    <title>Nearby TCM Clinics</title>
    <style>
      html, body { height: 100%; margin: 0; padding: 0; }
      #map { height: 100%; }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCSqqZiFermrGv95UXyp9RDmxxZQXtDcrI&libraries=places"></script>
    <script>
      function initMap(userLocation) {
        const map = new google.maps.Map(document.getElementById("map"), {
          center: userLocation,
          zoom: 15,
        });

        // Add user marker
        new google.maps.Marker({
          position: userLocation,
          map: map,
          title: "You are here",
          icon: "https://maps.google.com/mapfiles/ms/icons/blue-dot.png",
        });

        const service = new google.maps.places.PlacesService(map);
        service.nearbySearch({
          location: userLocation,
          radius: 3000, // in meters
          keyword: "Traditional Chinese Medicine clinic"
        }, (results, status) => {
          if (status === google.maps.places.PlacesServiceStatus.OK && results) {
            results.forEach(place => {
              if (place.geometry && place.geometry.location) {
                const marker = new google.maps.Marker({
                  position: place.geometry.location,
                  map: map,
                  title: place.name
                });

                const infowindow = new google.maps.InfoWindow({
                  content: `<strong>${place.name}</strong><br>${place.vicinity || ''}`
                });

                marker.addListener("click", () => {
                  infowindow.open(map, marker);
                });
              }
            });
          } else {
            console.error("No nearby places found or error:", status);
          }
        });
      }

      function getUserLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            position => {
              initMap({
                lat: position.coords.latitude,
                lng: position.coords.longitude
              });
            },
            () => {
              console.error("Geolocation failed, using fallback");
              initMap({ lat: 1.3521, lng: 103.8198 }); // Singapore fallback
            }
          );
        } else {
          initMap({ lat: 1.3521, lng: 103.8198 }); // fallback
        }
      }

      window.onload = getUserLocation;
    </script>
  </body>
</html>
