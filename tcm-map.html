<!DOCTYPE html>
<html>
  <head>
    <title>Nearby TCM Clinics</title>
    <style>
      html, body { height: 100%; margin: 0; padding: 0; }
      #map { height: 100%; }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script>
      function initMap(userLocation) {
        const map = new google.maps.Map(document.getElementById("map"), {
          center: userLocation,
          zoom: 14,
        });

        // You are here marker (updated to HTTPS)
        const userMarker = new google.maps.marker.AdvancedMarkerElement({
          map: map,
          position: userLocation,
          title: "You are here",
        });

        // Use findPlaceFromQuery to search for TCM clinics
        const request = {
          query: "Traditional Chinese Medicine clinic",
          fields: ["name", "geometry"],
          locationBias: new google.maps.LatLng(userLocation.lat, userLocation.lng)
        };

        const placesService = new google.maps.places.PlacesService(map);
        placesService.findPlaceFromQuery(request, (results, status) => {
          if (status === google.maps.places.PlacesServiceStatus.OK && results) {
            results.forEach(place => {
              if (place.geometry && place.geometry.location) {
                new google.maps.marker.AdvancedMarkerElement({
                  map: map,
                  position: place.geometry.location,
                  title: place.name,
                });
              }
            });
          } else {
            console.error("Places search error:", status);
          }
        });
      }

      function getUserLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            position => {
              const userLocation = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
              };
              initMap(userLocation);
            },
            error => {
              console.error("Geolocation error:", error);
              initMap({ lat: 1.3521, lng: 103.8198 }); // Default to Singapore
            }
          );
        } else {
          initMap({ lat: 1.3521, lng: 103.8198 }); // Fallback
        }
      }

      window.getUserLocation = getUserLocation;
    </script>

    <!-- Load Maps API with 'places' and 'marker' libraries -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places,marker&callback=getUserLocation"
      async
      defer
    ></script>
  </body>
</html>
